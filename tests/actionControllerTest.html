<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Action Controller Object Test Page</title>
  <link rel="stylesheet" href="../css/qunit.css">
</head>
<body>
  <div id="qunit"> </div>
  <script src="../src/libs/qunit.js"></script>
  <script src="../src/interfaceResource.js"></script>
  <script src="../src/sketch.js"></script>
  <script src="../src/utils.js"></script>
  <script src="../src/basicCommands.js"></script>
  <script src="../src/actionController.js"></script>
  
  <script>
  	/*module("Action Controller Basic test");
  	test
  	( 
  		"Action Controller manipulation", function()
  		{
  			var actionController = new ActionController();
  			//TODO:
  			ok( actionController.generateUndoCommmand(null) == false, "TODO");
  		}
  	);
  	*/
  	module("Command undo with only one command type");
  	test
  	( 
  		"Drag Command", function()
  		{
  			var i = 0;
  			var n = 10;
  			var x = 30;
			var y = 10;
			var btn1 = new InterfaceResource( x,y,0,100, 50, "Button", 0, 0 );
  			var actionController = new ActionController();
  			var dragCommand = new DragResourceCommand( basicCommandsGlobals.executionTypeEnum.CMEX_EDITION, btn1, x+x, y+y );
  			ok( actionController.undo() == null , "Nothing to be undone");
  			ok( actionController.redo() == null , "Nothing to be redone");
  			
  			//TODO:
  			ok( btn1.getX() == x, "In the start the button's X position is " + btn1.getX() );
  			ok( actionController.doCommand(dragCommand) == true, "Dragging this object");
  			ok( btn1.getX() == x+x, "After this the button's X position is " + btn1.getX() );
  			ok( actionController.undo() != null , "Undo the last action");
  			ok( btn1.getX() == x, "And the button is  back to the start X position " + btn1.getX() );
  			ok( actionController.redo() != null , "Redo the undone action");
  			ok( btn1.getX() == x+x, "After the redo the button's X position is " + btn1.getX() );
  			ok( actionController.undo() != null , "Undo the redo action");
  			ok( btn1.getX() == x, "And the button is  back to the start X position " + btn1.getX() + " again" );
  			
  			// Moving the object with n commands, at the end it will be on (x+n*n,y+n*n) position in units
  			for( i = 1; i <= n; i ++ )
  			{
  				dragCommand = new DragResourceCommand( basicCommandsGlobals.executionTypeEnum.CMEX_EDITION, btn1, x+i*n, y+i*n );
  				actionController.doCommand(dragCommand);
  			}
  			ok( btn1.getX() == x+n*n, "After moving "+n+" times the button's X position is " + (x+n*n) );
  			ok( actionController.undo() != null , "Undo the last action");
  			ok( btn1.getX() == x+n*(n-1), "After undo 1 times the button's X position is " + (x+n*(n-1)) );
  			for( i = 0; i < n-1; i ++ )
  			{
				if( actionController.undo() == null )
					break;
  			}
  			ok( i == n-1, "All the "+(n-1)+" commands have been undone");
  			ok( btn1.getX() == x, "And the button is  back to the start X position " + x );
  			ok( actionController.redo() != null , "Redo the undone action");
  			ok( actionController.redo() != null , "Redo the undone action again");
  			ok( btn1.getX() == x+2*n, "After the redo the button's X position is " + (x+2*n) );
  			ok( actionController.undo() != null , "Undo the redo action");
  			ok( actionController.undo() != null , "Undo the redo action again");
  			ok( btn1.getX() == x, "After this button is  back to the start X position " + btn1.getX() + " again" );
  			ok( actionController.undo() == null , "There are no more commands to be undone");
  		}
  	);
  	
  </script>
</body>
</html>